---
const url = new URL(Astro.request.url);

const menuLinks = [
  { title: "HOME", path: "/", key: "1" },
  { title: "ABOUT", path: "/about", key: "2" },
  { title: "BLOG", path: "/posts", key: "3" },
  { title: "RECIPES", path: "/recipes", key: "4" },
  { title: "PLAYLISTS", path: "/playlists", key: "5" },
  { title: "PROJECTS", path: "/projects", key: "6" },
  { title: "BOOKMARKS", path: "/bookmarks", key: "7" },
];
---

<script>
  import { toggleClass } from "@/utils";
  function toggleMenu() {
    const header = document.getElementById("main-header") as HTMLElement;
    const toggleMenuButton = document.getElementById("toggle-navigation-menu") as HTMLButtonElement;
    let menuOpen = false;

    toggleMenuButton.addEventListener("click", () => {
      toggleClass(header, "menu-open");
      menuOpen = !menuOpen;
      toggleMenuButton.setAttribute("aria-expanded", menuOpen.toString());
    });
  }
  document.addEventListener("DOMContentLoaded", toggleMenu);
  document.addEventListener("astro:after-swap", toggleMenu);
</script>

<header id="main-header" class="group relative mb-4">
  <!-- Top border line -->
  <div class="text-accent text-xs leading-none select-none hidden sm:block" aria-hidden="true">
    <span>┌──────────────────────────────────────────────────────────────────────────────┐</span>
  </div>

  <!-- Header content row -->
  <div class="flex items-center justify-between py-1 sm:py-0">
    <!-- Mobile: Simple left border -->
    <span class="text-accent hidden sm:inline select-none" aria-hidden="true">│</span>

    <!-- BBS Title -->
    <a
      href="/"
      class="flex items-center gap-2 bbs-link px-2"
      aria-current={url.pathname === "/" ? "page" : false}
    >
      <span class="text-accent font-bold text-sm sm:text-base">DR_DINOMIGHT BBS</span>
      <span class="text-bbs-gray text-xs hidden sm:inline">v2.0</span>
    </a>

    <!-- SysOp info -->
    <div class="hidden sm:flex items-center gap-4 text-xs">
      <span class="text-bbs-gray">[SysOp: <span class="text-bbs-cyan">Matt</span>]</span>
    </div>

    <!-- Mobile menu button -->
    <button
      id="toggle-navigation-menu"
      class="sm:hidden text-accent p-2 bbs-button text-xs"
      type="button"
      aria-label="Open main menu"
      aria-expanded="false"
      aria-haspopup="menu"
    >
      [MENU]
    </button>

    <span class="text-accent hidden sm:inline select-none" aria-hidden="true">│</span>
  </div>

  <!-- Separator line -->
  <div class="text-accent text-xs leading-none select-none hidden sm:block" aria-hidden="true">
    <span>├──────────────────────────────────────────────────────────────────────────────┤</span>
  </div>

  <!-- Navigation row -->
  <nav
    id="navigation-menu"
    class="hidden group-[.menu-open]:flex group-[.menu-open]:flex-col sm:flex sm:flex-row items-stretch sm:items-center py-1 bg-bgColor sm:bg-transparent"
    aria-label="Main menu"
  >
    <span class="text-accent hidden sm:inline select-none" aria-hidden="true">│</span>

    <div class="flex flex-col sm:flex-row flex-wrap px-2 gap-1 sm:gap-0">
      {menuLinks.map((link, index) => (
        <a
          href={link.path}
          class:list={[
            "bbs-menu-item px-2 py-1 sm:py-0 text-xs sm:text-sm",
            url.pathname === link.path || (link.path !== "/" && url.pathname.startsWith(link.path))
              ? "bg-accent text-black"
              : "text-bbs-cyan hover:bg-accent hover:text-black"
          ]}
          aria-current={url.pathname === link.path ? "page" : false}
          aria-label={link.title}
          rel="prefetch"
        >
          <span class="text-bbs-magenta" aria-hidden="true">[{link.key}]</span>{link.title}
        </a>
      ))}
    </div>

    <span class="text-accent hidden sm:inline select-none ml-auto" aria-hidden="true">│</span>
  </nav>

  <!-- Bottom border line -->
  <div class="text-accent text-xs leading-none select-none hidden sm:block" aria-hidden="true">
    <span>└──────────────────────────────────────────────────────────────────────────────┘</span>
  </div>

  <!-- Mobile bottom border -->
  <div class="sm:hidden border-b border-accent"></div>
</header>

<style>
  /* Ensure monospace alignment */
  header {
    font-family: 'IBM Plex Mono', monospace;
  }

  /* Active/current page indicator */
  a[aria-current="page"] {
    background: var(--theme-accent);
    color: #000;
  }

  /* Menu animation for mobile */
  #navigation-menu {
    transition: all 0.2s ease;
  }

  .group.menu-open #navigation-menu {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    z-index: 50;
    border: 1px solid var(--theme-accent);
    border-top: none;
  }

  @media (min-width: 640px) {
    .group.menu-open #navigation-menu {
      position: static;
      border: none;
    }
  }
</style>
