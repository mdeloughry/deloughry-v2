---
const url = new URL(Astro.request.url);

const menuLinks = [
  { title: "Home", path: "/" },
  { title: "About", path: "/about" },
  { title: "Blog", path: "/posts" },
  { title: "Recipes", path: "/recipes" },
  { title: "Playlists", path: "/playlists" },
  { title: "Projects", path: "/projects" },
  { title: "Bookmarks", path: "/bookmarks" },
];
---

<script>
  import { toggleClass } from "@/utils";
  function toggleMenu() {
    const header = document.getElementById("main-header") as HTMLElement;
    const toggleMenuButton = document.getElementById("toggle-navigation-menu") as HTMLButtonElement;
    let menuOpen = false;

    toggleMenuButton.addEventListener("click", () => {
      toggleClass(header, "menu-open");
      menuOpen = !menuOpen;
      toggleMenuButton.setAttribute("aria-expanded", menuOpen.toString());
    });
  }
  document.addEventListener("DOMContentLoaded", toggleMenu);
  document.addEventListener("astro:after-swap", toggleMenu);
</script>

<header id="main-header" class="group mb-12 border-b-4 border-accent pb-6">
  <div class="flex flex-col gap-4">
    <!-- Logo / Name -->
    <a
      href="/"
      class="inline-block"
      aria-current={url.pathname === "/" ? "page" : false}
    >
      <h1 class="glitch-text text-massive font-mono font-bold text-accent leading-none" data-text="MPD">
        MPD
      </h1>
      <span class="block text-sm font-mono text-muted tracking-widest mt-2">
        MATTHEW_PECK-DELOUGHRY
      </span>
    </a>

    <!-- Navigation -->
    <nav
      id="navigation-menu"
      class="absolute -inset-x-4 top-full hidden flex-col gap-0 bg-bgColor border-4 border-accent p-4 group-[.menu-open]:z-50 group-[.menu-open]:flex md:static md:flex md:flex-row md:items-center md:gap-1 md:border-0 md:bg-transparent md:p-0"
      aria-label="Main menu"
    >
      {menuLinks.map((link, index) => (
        <>
          {index > 0 && <span class="hidden md:inline text-accent font-mono">|</span>}
          <a
            href={link.path}
            class="nav-link px-3 py-2 font-mono text-sm uppercase tracking-wider text-textColor transition-all hover:text-accent hover:bg-accent/10"
            aria-current={url.pathname === link.path ? "page" : false}
            data-text={link.title}
            rel="prefetch"
          >
            {link.title}
          </a>
        </>
      ))}
    </nav>
  </div>

  <!-- Mobile menu button -->
  <button
    id="toggle-navigation-menu"
    class="group/btn absolute right-4 top-8 h-10 w-10 border-2 border-accent bg-transparent md:hidden"
    type="button"
    aria-label="Open main menu"
    aria-expanded="false"
    aria-haspopup="menu"
  >
    <!-- Hamburger icon -->
    <svg
      class="absolute left-1/2 top-1/2 h-6 w-6 -translate-x-1/2 -translate-y-1/2 text-accent transition-all group-aria-expanded/btn:scale-0 group-aria-expanded/btn:opacity-0"
      aria-hidden="true"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="2"
      stroke="currentColor"
    >
      <path stroke-linecap="square" stroke-linejoin="miter" d="M4 6h16M4 12h16M4 18h16"></path>
    </svg>
    <!-- Close icon -->
    <svg
      class="absolute left-1/2 top-1/2 h-6 w-6 -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded/btn:scale-100 group-aria-expanded/btn:opacity-100"
      aria-hidden="true"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="2"
      stroke="currentColor"
    >
      <path stroke-linecap="square" stroke-linejoin="miter" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
  </button>
</header>

<style>
  .nav-link[aria-current="page"] {
    color: var(--theme-accent);
    background: rgba(218, 255, 1, 0.1);
  }

  .nav-link[aria-current="page"]::before {
    content: ">";
    margin-right: 0.25rem;
  }

  /* Clean hover effect for nav links */
  .nav-link {
    position: relative;
  }

  .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 2px;
    background: var(--theme-accent);
    transition: width 0.2s ease, left 0.2s ease;
  }

  .nav-link:hover::after {
    width: 100%;
    left: 0;
  }
</style>
