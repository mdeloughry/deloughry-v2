---
import PageLayout from "@/layouts/Base";
import { getAllProjects } from "@/lib/projects.data";
import { getUniqueTagsWithCountFromTags, getTagSlug, formatTagForDisplay } from "@/utils";

const allProjects = await getAllProjects();
const allTags = getUniqueTagsWithCountFromTags(allProjects);

const meta = {
	title: "Project Tags",
	description: "Browse projects by tags and categories",
};
export const prerender = true;
---

<PageLayout meta={meta}>
	<div class="project-tags-page">
		<header class="page-header">
			<h1 class="page-title"><span class="accent-slash">//</span> Project Tags</h1>
			<p class="page-subtitle">Browse projects by tags and categories</p>
		</header>

		<div class="tags-grid">
			{Object.entries(allTags).map(([tag, val]) => (
				<article class="tag-card">
					<a
						href={`/projects/tags/${getTagSlug(tag)}`}
						title={`View projects with the tag: ${formatTagForDisplay(tag)}`}
						rel="prefetch"
						class="tag-link"
					>
						<h3 class="tag-name">#{formatTagForDisplay(tag)}</h3>
						<p class="tag-count">
							{val} Project{val > 1 ? "s" : ""}
						</p>
					</a>
				</article>
			))}
		</div>
	</div>

	<style>
		.project-tags-page {
			display: flex;
			flex-direction: column;
			gap: var(--space-xl);
		}

		/* Page header and title styles from global.css */

		.tags-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
			gap: var(--space-md);
		}

		.tag-card {
			background: var(--theme-bg-secondary);
			border: var(--border-weight) solid rgba(255, 255, 255, 0.08);
			border-radius: var(--radius-subtle);
			overflow: hidden;
			transition: border-color var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
		}

		.tag-card:hover {
			border-color: var(--theme-accent);
			transform: translate(-3px, -3px);
			box-shadow: 3px 3px 0 var(--theme-accent);
		}

		.tag-link {
			display: block;
			padding: var(--space-md);
			text-decoration: none;
			color: inherit;
			text-align: center;
		}

		.tag-name {
			margin: 0 0 var(--space-xs) 0;
			font-family: 'JetBrains Mono', monospace;
			font-size: var(--text-base);
			font-weight: 600;
			color: var(--theme-accent);
			letter-spacing: -0.01em;
		}

		.tag-count {
			margin: 0;
			font-family: 'JetBrains Mono', monospace;
			font-size: var(--text-xs);
			color: var(--theme-muted);
		}

		@media (max-width: 768px) {
			.tags-grid {
				grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
				gap: var(--space-sm);
			}

			.tag-link {
				padding: var(--space-sm);
			}

			.tag-name {
				font-size: var(--text-sm);
			}
		}

		@media (prefers-reduced-motion: reduce) {
			.tag-card:hover {
				transform: none;
				box-shadow: none;
			}
		}
	</style>
</PageLayout>
