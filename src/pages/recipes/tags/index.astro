---
import PageLayout from "@/layouts/Base";
import { getUniqueRecipeTagsWithCount, getTagsByCategory, formatTagForDisplay } from "../../../utils/tags";
import { getAllRecipes } from "@/lib/recipes.data";

const allRecipes = await getAllRecipes();
const allTags = getUniqueRecipeTagsWithCount(allRecipes);
const categorizedTags = getTagsByCategory(Object.keys(allTags));

const meta = {
	title: "Recipe Tags",
	description: "Browse recipes by tags and categories",
};
export const prerender = true;
---

<PageLayout meta={meta}>
	<div class="recipe-tags-page">
		<header class="page-header">
			<h1 class="page-title"><span class="accent-slash">//</span> Recipe Tags</h1>
			<p class="page-subtitle">Browse recipes by tags and categories</p>
		</header>

		<!-- All Tags Section -->
		<section class="all-tags-section">
			<h2 class="section-title">All Tags</h2>
			<div class="tags-grid">
				{Object.entries(allTags).map(([tag, count]: [string, number]) => (
					<article class="tag-card">
						<a
							href={`/recipes/tags/${tag}`}
							title={`View recipes with the tag: ${formatTagForDisplay(tag)}`}
							rel="prefetch"
							class="tag-link"
						>
							<h3 class="tag-name">#{formatTagForDisplay(tag)}</h3>
							<p class="tag-count">
								{count} Recipe{count > 1 ? "s" : ""}
							</p>
						</a>
					</article>
				))}
			</div>
		</section>

		<!-- Categorized Tags -->
		{Object.keys(categorizedTags).length > 0 && (
			<section class="categorized-tags-section">
				<h2 class="section-title">Categories</h2>
				{Object.entries(categorizedTags).map(([category, tags]: [string, string[]]) => (
					<div class="category-section">
						<h3 class="category-title">{formatTagForDisplay(category)}</h3>
						<div class="category-tags">
							{tags.map((tag) => (
								<a
									href={`/recipes/tags/${tag}`}
									class="category-tag"
									title={`View ${formatTagForDisplay(tag)} recipes`}
								>
									{formatTagForDisplay(tag)}
									<span class="tag-count-small">({allTags[tag]})</span>
								</a>
							))}
						</div>
					</div>
				))}
			</section>
		)}
	</div>

	<style>
		.recipe-tags-page {
			display: flex;
			flex-direction: column;
			gap: var(--space-xl);
		}

		/* Page header and title styles from global.css */

		.all-tags-section {
			margin-bottom: var(--space-xl);
		}

		.section-title {
			font-family: 'JetBrains Mono', monospace;
			font-size: var(--text-xl);
			font-weight: 600;
			color: var(--color-pink);
			margin: 0 0 var(--space-lg) 0;
			padding-bottom: var(--space-xs);
			border-bottom: var(--border-weight) solid var(--theme-accent);
			letter-spacing: -0.01em;
		}

		.tags-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
			gap: var(--space-md);
		}

		.tag-card {
			background: var(--theme-bg-secondary);
			border: var(--border-weight) solid rgba(255, 255, 255, 0.08);
			border-radius: var(--radius-subtle);
			overflow: hidden;
			transition: border-color var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
		}

		.tag-card:hover {
			border-color: var(--theme-accent);
			transform: translate(-3px, -3px);
			box-shadow: 3px 3px 0 var(--theme-accent);
		}

		.tag-link {
			display: block;
			padding: var(--space-md);
			text-decoration: none;
			color: inherit;
			text-align: center;
		}

		.tag-name {
			font-family: 'JetBrains Mono', monospace;
			font-size: var(--text-base);
			font-weight: 600;
			color: var(--theme-accent);
			margin: 0 0 var(--space-xs) 0;
			letter-spacing: -0.01em;
		}

		.tag-count {
			font-family: 'JetBrains Mono', monospace;
			font-size: var(--text-xs);
			color: var(--theme-muted);
			margin: 0;
		}

		.categorized-tags-section {
			margin-top: var(--space-xl);
		}

		.category-section {
			margin-bottom: var(--space-lg);
		}

		.category-title {
			font-family: 'JetBrains Mono', monospace;
			font-size: var(--text-lg);
			font-weight: 600;
			color: var(--color-info);
			margin: 0 0 var(--space-sm) 0;
			letter-spacing: -0.01em;
		}

		.category-tags {
			display: flex;
			flex-wrap: wrap;
			gap: var(--space-xs);
		}

		.category-tag {
			display: inline-flex;
			align-items: center;
			gap: 0.25rem;
			padding: var(--space-xs) var(--space-sm);
			background: var(--theme-bg-secondary);
			border: var(--border-weight) solid rgba(255, 255, 255, 0.08);
			border-radius: var(--radius-subtle);
			text-decoration: none;
			color: var(--theme-text);
			font-family: 'JetBrains Mono', monospace;
			font-size: var(--text-sm);
			transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast);
		}

		.category-tag:hover {
			background: var(--theme-accent);
			color: var(--theme-bg);
			border-color: var(--theme-accent);
		}

		.tag-count-small {
			font-size: var(--text-xs);
			opacity: 0.7;
		}

		@media (max-width: 768px) {
			.tags-grid {
				grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
				gap: var(--space-sm);
			}

			.tag-link {
				padding: var(--space-sm);
			}

			.tag-name {
				font-size: var(--text-sm);
			}
		}

		@media (prefers-reduced-motion: reduce) {
			.tag-card:hover {
				transform: none;
				box-shadow: none;
			}
		}
	</style>
</PageLayout>
