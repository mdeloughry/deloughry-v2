---
import { getCollection } from "astro:content";
import PageLayout from "@/layouts/Base";
import SocialList from "@/components/SocialList";
import { sortMDByDate, getTagSlug, formatTagForDisplay, formatAsSize, formatLsDate } from "@/utils";

const MAX_POSTS = 10;
const allPosts = await getCollection("post");
const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS);
export const prerender = true;
---

<PageLayout meta={{ title: "Home" }}>
  <div class="terminal-home">
    <!-- Boot Sequence / Hero -->
    <section class="hero-section" aria-labelledby="hero-title">
      <div class="boot-sequence" aria-hidden="true">
        <div class="boot-line">
          <span class="boot-ok">[OK]</span>
          <span>Loading personality matrix...</span>
        </div>
        <div class="boot-line">
          <span class="boot-ok">[OK]</span>
          <span>Initializing dev environment...</span>
        </div>
        <div class="boot-line">
          <span class="boot-ok">[OK]</span>
          <span>Connecting to mainframe...</span>
        </div>
      </div>

      <!-- Whoami Output -->
      <div class="whoami-section">
        <div class="command-line" aria-hidden="true">
          <span class="prompt">$</span>
          <span class="command">whoami</span>
        </div>
        <div class="output-block">
          <pre class="ascii-skull" aria-hidden="true">
    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
   ████████████████████████
  ██████▀▀▀▀▀▀▀▀▀▀▀▀██████
  ████                ████
  ████   ▄██▄  ▄██▄   ████
  ████   ████  ████   ████
  ████                ████
  █████▄            ▄█████
  ███████▄▄▄▄▄▄▄▄▄███████
   ██████████████████████
    ▀▀▀██▀▀▀▀▀▀▀▀██▀▀▀▀
        ██      ██
        ▀▀▀▀▀▀▀▀▀▀
          </pre>
          <div class="user-info">
            <a class="u-url hidden" rel="me" href="https://deloughry.co.uk/">Matthew Peck-Deloughry</a>
            <a class="u-url hidden" href="acct:matt@deloughry.co.uk"></a>
            <h1 id="hero-title" class="sr-only">Matthew Peck-Deloughry - Developer, Streamer, and Tooter from Sheffield, UK</h1>
            <p class="info-line"><span class="key">USER:</span> <span class="value">dr_dinomight</span></p>
            <p class="info-line"><span class="key">NAME:</span> <span class="value">Matthew Peck-Deloughry</span></p>
            <p class="info-line"><span class="key">ROLE:</span> <span class="value text-link">Developer</span> <span aria-hidden="true">|</span> <span class="value text-twitch">Streamer</span> <span aria-hidden="true">|</span> <span class="value text-mastodon">Tooter</span></p>
            <p class="info-line"><span class="key">LOCATION:</span> <span class="value">Sheffield, UK</span></p>
            <p class="info-line"><span class="key">STATUS:</span> <span class="value status-online">ONLINE</span><span class="cursor-inline" aria-hidden="true"></span></p>
          </div>
        </div>
      </div>

      <!-- Typing Effect Title -->
      <div class="hero-title" aria-hidden="true">
        <span class="typing-line line-1">Developer.</span>
        <span class="typing-line line-2">Streamer.</span>
        <span class="typing-line line-3"><span class="strikethrough">Tweeter.</span><span class="text-mastodon">Tooter.</span></span>
        <span class="typing-line line-4">&amp; a little bit of everything <span class="text-accent glow">Nerdy!</span><span class="cursor"></span></span>
      </div>
    </section>

    <!-- About Section -->
    <section class="about-section" aria-labelledby="about-title">
      <h2 id="about-title" class="sr-only">About Me</h2>
      <div class="section-header" aria-hidden="true">
        <span class="prompt">$</span>
        <span class="command">cat ~/about.txt</span>
      </div>
      <div class="terminal-window">
        <div class="terminal-header">
          <div class="terminal-dots">
            <span class="terminal-dot red"></span>
            <span class="terminal-dot yellow"></span>
            <span class="terminal-dot green"></span>
          </div>
          <span class="terminal-title">~/about.txt</span>
        </div>
        <div class="terminal-content">
          <p class="p-note">
            Aye up, I'm Matt (aka Dr_DinoMight), a developer of something around 15 years
            (I think!? They all blend into one now).
          </p>
          <p class="p-note">
            I'm a Full Stack Developer who loves to tinker with anything and everything.
            I love to build, be it personal 1 person projects or large scale community projects,
            as long as it's code it floats my boat!
          </p>
          <p class="tagline glow">
            "Av' fun developing, Av' fun learning, then Av'a crack at engineering it!"
          </p>
        </div>
      </div>
      <div class="social-section">
        <SocialList />
      </div>
    </section>

    <!-- Recent Posts Section -->
    <section class="posts-section" aria-labelledby="posts-title">
      <h2 id="posts-title" class="sr-only">Recent Blog Posts</h2>
      <div class="section-header" aria-hidden="true">
        <span class="prompt">$</span>
        <span class="command">ls -la ./blog | head -10</span>
      </div>

      <div class="file-listing" role="list" aria-label="Recent blog posts">
        <div class="file-header" aria-hidden="true">
          <span class="col-perms">drwxr-xr-x</span>
          <span class="col-size">SIZE</span>
          <span class="col-date">DATE</span>
          <span class="col-name">NAME</span>
        </div>

        {allPostsByDate.map((p) => (
          <article class="file-row flicker-hover" role="listitem">
            <span class="col-perms" aria-hidden="true">-rw-r--r--</span>
            <span class="col-size" aria-hidden="true">{formatAsSize(p.data.description || '')}</span>
            <time class="col-date" datetime={p.data.publishDate.toISOString()}>{formatLsDate(p.data.publishDate)}</time>
            <span class="col-name">
              <a href={`/posts/${p.slug}/`} class="file-link">
                <span aria-hidden="true">{p.data.title.toLowerCase().replace(/\s+/g, '-')}.md</span>
                <span class="sr-only">{p.data.title}</span>
              </a>
              {p.data.tags && p.data.tags.length > 0 && (
                <span class="file-tags">
                  {p.data.tags.slice(0, 3).map((tag) => (
                    <a href={`/tags/${getTagSlug(tag)}`} class="terminal-tag" title={`View posts with tag: ${formatTagForDisplay(tag)}`}>
                      <span aria-hidden="true">[{formatTagForDisplay(tag)}]</span>
                      <span class="sr-only">Tag: {formatTagForDisplay(tag)}</span>
                    </a>
                  ))}
                </span>
              )}
            </span>
          </article>
        ))}

        <div class="file-footer">
          <span class="text-quote" aria-hidden="true">total {allPostsByDate.length} files</span>
          <a href="/posts" class="more-link">
            <span class="prompt" aria-hidden="true">$</span>
            <span aria-hidden="true">ls -la ./blog --all</span>
            <span class="sr-only">View all blog posts</span>
          </a>
        </div>
      </div>
    </section>
  </div>
</PageLayout>

<style>
  .terminal-home {
    font-family: 'JetBrains Mono', monospace;
  }

  /* Boot Sequence */
  .boot-sequence {
    margin-bottom: 2rem;
    padding: 1rem;
    border: 1px dashed var(--theme-text);
    background: rgba(0, 255, 135, 0.02);
  }

  .boot-line {
    display: flex;
    gap: 1rem;
    font-size: 0.875rem;
    margin-bottom: 0.25rem;
    opacity: 0;
    animation: boot-in 0.5s ease-out forwards;
  }

  .boot-line:nth-child(1) { animation-delay: 0.2s; }
  .boot-line:nth-child(2) { animation-delay: 0.4s; }
  .boot-line:nth-child(3) { animation-delay: 0.6s; }

  @keyframes boot-in {
    from {
      opacity: 0;
      transform: translateX(-10px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .boot-ok {
    color: var(--theme-text);
  }

  /* Whoami Section */
  .whoami-section {
    margin-bottom: 2rem;
  }

  .command-line {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .prompt {
    color: var(--theme-accent);
  }

  .command {
    color: var(--theme-link);
  }

  .output-block {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
    flex-wrap: wrap;
  }

  .ascii-skull {
    color: var(--theme-accent);
    text-shadow: 0 0 5px var(--theme-accent);
    font-size: 0.6rem;
    line-height: 1.1;
    margin: 0;
    flex-shrink: 0;
  }

  .user-info {
    flex: 1;
    min-width: 200px;
  }

  .info-line {
    margin: 0.5rem 0;
    font-size: 0.875rem;
  }

  .key {
    color: var(--theme-quote);
    min-width: 80px;
    display: inline-block;
  }

  .value {
    color: var(--theme-text);
  }

  .status-online::before {
    content: "● ";
    animation: blink 2s ease-in-out infinite;
  }

  /* Hero Title with Typing Effect */
  .hero-title {
    font-size: 1.5rem;
    line-height: 1.8;
    margin: 2rem 0;
    padding: 1rem;
    border-left: 3px solid var(--theme-accent);
  }

  .typing-line {
    display: block;
    opacity: 0;
    animation: type-in 0.5s ease-out forwards;
  }

  .line-1 { animation-delay: 0.8s; }
  .line-2 { animation-delay: 1.0s; }
  .line-3 { animation-delay: 1.2s; }
  .line-4 { animation-delay: 1.4s; }

  @keyframes type-in {
    from {
      opacity: 0;
      transform: translateY(5px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .strikethrough {
    text-decoration: line-through;
    color: var(--theme-quote);
    margin-right: 0.5rem;
  }

  .glow {
    text-shadow: 0 0 5px var(--theme-accent), 0 0 10px var(--theme-accent);
  }

  .cursor::after {
    content: "█";
    animation: blink 1s step-end infinite;
    color: var(--theme-accent);
  }

  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  /* Section Styling */
  .section-header {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    font-size: 1rem;
  }

  .about-section,
  .posts-section {
    margin-top: 3rem;
  }

  /* Terminal Window */
  .terminal-window {
    border: 1px solid var(--theme-text);
    margin-bottom: 1.5rem;
  }

  .terminal-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.5rem 1rem;
    background: rgba(0, 255, 135, 0.05);
    border-bottom: 1px solid var(--theme-text);
  }

  .terminal-dots {
    display: flex;
    gap: 0.5rem;
  }

  .terminal-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
  }

  .terminal-dot.red { background: #FF4757; box-shadow: 0 0 5px #FF4757; }
  .terminal-dot.yellow { background: #DAFF01; box-shadow: 0 0 5px #DAFF01; }
  .terminal-dot.green { background: #00FF87; box-shadow: 0 0 5px #00FF87; }

  .terminal-title {
    flex: 1;
    text-align: center;
    color: var(--theme-quote);
    font-size: 0.875rem;
  }

  .terminal-content {
    padding: 1.5rem;
  }

  .terminal-content p {
    margin: 0 0 1rem 0;
    line-height: 1.6;
  }

  .terminal-content p:last-child {
    margin-bottom: 0;
  }

  .tagline {
    color: var(--theme-accent);
    font-style: italic;
    border-left: 2px solid var(--theme-accent);
    padding-left: 1rem;
    margin-top: 1.5rem;
  }

  .social-section {
    margin-top: 1.5rem;
  }

  /* File Listing */
  .file-listing {
    border: 1px solid var(--theme-text);
    overflow-x: auto;
  }

  .file-header {
    display: grid;
    grid-template-columns: 100px 60px 100px 1fr;
    gap: 1rem;
    padding: 0.75rem 1rem;
    background: rgba(0, 255, 135, 0.05);
    border-bottom: 1px dashed var(--theme-text);
    font-size: 0.75rem;
    color: var(--theme-quote);
  }

  .file-row {
    display: grid;
    grid-template-columns: 100px 60px 100px 1fr;
    gap: 1rem;
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    border-bottom: 1px dotted rgba(0, 255, 135, 0.2);
    transition: background 0.2s ease;
  }

  .file-row:hover {
    background: rgba(0, 255, 135, 0.05);
  }

  .col-perms {
    color: var(--theme-quote);
    font-size: 0.75rem;
  }

  .col-size {
    color: var(--theme-quote);
    text-align: right;
  }

  .col-date {
    color: var(--theme-text);
  }

  .col-name {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.5rem;
  }

  .file-link {
    color: var(--theme-link);
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .file-link:hover {
    color: var(--theme-accent);
    text-shadow: 0 0 5px var(--theme-accent);
  }

  .file-tags {
    display: flex;
    gap: 0.25rem;
    flex-wrap: wrap;
  }

  .terminal-tag {
    color: var(--theme-quote);
    font-size: 0.7rem;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .terminal-tag:hover {
    color: var(--theme-accent);
  }

  .file-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1rem;
    border-top: 1px dashed var(--theme-text);
    font-size: 0.75rem;
  }

  .text-quote {
    color: var(--theme-quote);
  }

  .more-link {
    color: var(--theme-link);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .more-link:hover {
    color: var(--theme-accent);
    text-shadow: 0 0 5px var(--theme-accent);
  }

  .more-link .prompt {
    color: var(--theme-accent);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .file-header,
    .file-row {
      grid-template-columns: 1fr;
      gap: 0.25rem;
    }

    .col-perms,
    .col-size {
      display: none;
    }

    .col-date {
      font-size: 0.75rem;
      color: var(--theme-quote);
    }

    .hero-title {
      font-size: 1.25rem;
    }

    .ascii-skull {
      display: none;
    }

    .output-block {
      flex-direction: column;
    }
  }
</style>
