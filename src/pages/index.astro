---
import { getCollection } from "astro:content";
import PageLayout from "@/layouts/Base";
import SocialList from "@/components/SocialList";
import MeImage from "../assets/profile-glitch.webp";
import { sortMDByDate, getTagSlug, formatTagForDisplay } from "@/utils";
import { Image } from "astro:assets";

const MAX_POSTS = 6;
const allPosts = await getCollection("post");
const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS);
export const prerender = true;
---

<PageLayout meta={{ title: "Home" }}>
  <div class="home-page">
    <!-- Hero Section - Clean and confident -->
    <section class="hero-section">
      <div class="hero-grid">
        <!-- Profile Image -->
        <div class="hero-image-container crt-filter">
          <Image
            src={MeImage}
            height={MeImage.height}
            width={MeImage.width}
            alt="Matthew Peck-Deloughry"
            class="hero-image crt-image"
            transition:name="profile-image"
          />
        </div>

        <!-- Hero Text -->
        <div class="hero-content">
          <a class="u-url hidden" rel="me" href="https://deloughry.co.uk/"
            >Matthew Peck-Deloughry</a
          >
          <a class="u-url hidden" href="acct:matt@deloughry.co.uk"></a>

          <div class="hero-roles">
            <span class="role-item text-accent glow-accent">Developer</span>
            <span class="role-divider" aria-hidden="true">//</span>
            <span class="role-item text-purple glow-purple">Streamer</span>
            <span class="role-divider" aria-hidden="true">//</span>
            <span class="role-item text-cyan glow-cyan">Maker</span>
          </div>
        </div>
      </div>
    </section>

    <!-- About Section -->
    <section class="about-section">
      <div class="about-content">
        <p class="p-note">
          Aye up, I'm Matt (aka Dr_DinoMight), a developer of around 15 years.
          Full Stack Developer who loves to tinker with anything and everything.
          I love to build, be it personal projects or large scale community
          projects. As long as it's code it floats my boat!
        </p>
        <div class="mt-8">
          <SocialList />
        </div>
      </div>
    </section>

    <!-- Motto Section -->
    <section class="motto-section">
      <blockquote class="motto-quote">
        <span class="quote-mark" aria-hidden="true">"</span>
        <span class="quote-text">
          Av' fun developing, Av' fun learning, then Av'a crack at engineering
          it!
        </span>
        <span class="quote-mark" aria-hidden="true">"</span>
        <span class="cursor" aria-hidden="true">_</span>
      </blockquote>
    </section>

    <!-- Recent Posts Section -->
    <section class="posts-section">
      <div class="section-header">
        <h2 class="section-title slash-prefix">Recent Posts</h2>
        <a href="/posts" class="brutal-btn"> View all</a>
      </div>

      <div class="posts-grid stagger-reveal">
        {
          allPostsByDate.map((p) => (
            <article class="brutal-card post-card">
              {p.data.ogImage && (
                <div class="post-card-image">
                  <img src={p.data.ogImage} alt={p.data.title} loading="lazy" />
                </div>
              )}
              <div class="post-card-content">
                <time
                  datetime={p.data.publishDate.toISOString()}
                  class="post-date"
                >
                  {new Date(p.data.publishDate).toLocaleDateString("en-GB", {
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                  })}
                </time>
                <h3 class="post-title">
                  <a href={`/posts/${p.slug}/`}>{p.data.title}</a>
                </h3>
                {p.data.description && (
                  <p class="post-description">{p.data.description}</p>
                )}
                {p.data.tags && p.data.tags.length > 0 && (
                  <div class="post-tags">
                    {p.data.tags.slice(0, 3).map((tag) => (
                      <a
                        href={`/tags/${getTagSlug(tag)}`}
                        class="brutal-tag"
                        title={`View posts with tag: ${formatTagForDisplay(
                          tag,
                        )}`}
                      >
                        {formatTagForDisplay(tag)}
                      </a>
                    ))}
                  </div>
                )}
              </div>
            </article>
          ))
        }
      </div>
    </section>
  </div>

  <style>
    .home-page {
      display: flex;
      flex-direction: column;
      gap: var(--space-2xl);
    }

    /* Hero Section */
    .hero-section {
      padding: var(--space-lg) 0;
    }

    .hero-grid {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: var(--space-xl);
      align-items: center;
    }

    .hero-image-container {
      position: relative;
      width: 180px;
      height: 180px;
    }

    .hero-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: var(--radius-subtle);
      filter: grayscale(100%) contrast(1.05);
      transition: filter var(--transition-slow);
    }

    .hero-image-container:hover .hero-image {
      filter: grayscale(0%) contrast(1);
    }

    .hero-content {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .hero-roles {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      flex-wrap: wrap;
    }

    .role-item {
      font-family: "JetBrains Mono", monospace;
      font-size: var(--text-display);
      font-weight: 600;
      color: var(--theme-text);
      letter-spacing: -0.02em;
    }

    .role-divider {
      color: var(--theme-accent);
      font-size: var(--text-lg);
      opacity: 0.5;
    }

    /* About Section */
    .about-section {
      max-width: 680px;
    }

    .about-content {
      color: var(--theme-text);
    }

    .p-note {
      font-size: var(--text-lg);
      line-height: 1.8;
      color: var(--theme-muted);
    }

    /* Motto Section */
    .motto-section {
      padding: var(--space-xl) 0;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .motto-quote {
      font-family: "JetBrains Mono", monospace;
      font-size: var(--text-xl);
      text-align: center;
      color: var(--theme-text);
      margin: 0;
      padding: 0;
      border: none;
    }

    .quote-mark {
      color: var(--theme-accent);
      font-size: 1.5em;
      vertical-align: -0.1em;
    }

    .cursor {
      color: var(--theme-accent);
      animation: blink 1s step-end infinite;
    }

    @keyframes blink {
      0%,
      100% {
        opacity: 1;
      }
      50% {
        opacity: 0;
      }
    }

    /* Posts Section */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-lg);
      flex-wrap: wrap;
      gap: var(--space-sm);
    }

    .section-title {
      font-family: "JetBrains Mono", monospace;
      font-size: var(--text-xl);
      font-weight: 600;
      color: var(--theme-text);
      letter-spacing: -0.01em;
    }

    .posts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: var(--space-md);
    }

    .post-card {
      display: flex;
      flex-direction: column;
    }

    .post-card-image {
      position: relative;
      height: 160px;
      overflow: hidden;
      margin: calc(var(--space-md) * -1) calc(var(--space-md) * -1)
        var(--space-sm) calc(var(--space-md) * -1);
      border-radius: var(--radius-subtle) var(--radius-subtle) 0 0;
    }

    .post-card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: grayscale(100%);
      transition:
        filter var(--transition-medium),
        transform var(--transition-medium);
    }

    .post-card:hover .post-card-image img {
      filter: grayscale(0%);
      transform: scale(1.02);
    }

    .post-date {
      display: block;
      font-family: "JetBrains Mono", monospace;
      font-size: var(--text-xs);
      color: var(--theme-muted);
      margin-bottom: var(--space-xs);
    }

    .post-title {
      font-family: "JetBrains Mono", monospace;
      font-size: var(--text-lg);
      font-weight: 600;
      margin: 0 0 var(--space-xs) 0;
      line-height: 1.3;
      letter-spacing: -0.01em;
    }

    .post-title a {
      color: var(--theme-text);
      transition: color var(--transition-fast);
    }

    .post-title a:hover {
      color: var(--theme-accent);
    }

    .post-description {
      font-size: var(--text-sm);
      color: var(--theme-muted);
      line-height: 1.6;
      margin: 0 0 var(--space-sm) 0;
    }

    .post-tags {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-xs);
      margin-top: auto;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .hero-grid {
        grid-template-columns: 1fr;
        text-align: center;
      }

      .hero-image-container {
        margin: 0 auto;
        width: 140px;
        height: 140px;
      }

      .hero-roles {
        justify-content: center;
      }

      .role-item {
        font-size: var(--text-2xl);
      }

      .posts-grid {
        grid-template-columns: 1fr;
      }

      .section-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</PageLayout>
