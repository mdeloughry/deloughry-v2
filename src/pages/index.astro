---
import { getCollection } from "astro:content";
import PageLayout from "@/layouts/Base";
import SocialList from "@/components/SocialList";
import MeImage from "../assets/image.webp";
import { sortMDByDate, getTagSlug, formatTagForDisplay } from "@/utils";
import { Image } from "astro:assets";

const MAX_POSTS = 6;
const allPosts = await getCollection("post");
const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS);
export const prerender = true;
---

<PageLayout meta={{ title: "Home" }}>
	<div class="home-page">
		<!-- Hero Section with MASSIVE Typography -->
		<section class="hero-section">
			<div class="hero-grid">
				<!-- Profile Image with glitch border -->
				<div class="hero-image-container">
					<Image
						src={MeImage}
						height={MeImage.height}
						width={MeImage.width}
						alt="Matthew Peck-Deloughry"
						class="hero-image"
						transition:name={"profile-image"}
					/>
					<div class="image-glitch-overlay" aria-hidden="true"></div>
				</div>

				<!-- Hero Text -->
				<div class="hero-content">
					<a class="u-url hidden" rel="me" href="https://deloughry.co.uk/">Matthew Peck-Deloughry</a>
					<a class="u-url hidden" href="acct:matt@deloughry.co.uk"></a>

					<div class="hero-titles">
						<h2 class="hero-role glitch-text" data-text="DEVELOPER_">
							<span class="text-glitch-cyan">DEVELOPER_</span>
						</h2>
						<h2 class="hero-role">
							<span class="text-twitch">STREAMER_</span>
						</h2>
						<h2 class="hero-role">
							<span class="text-mastodon">TOOTER_</span>
						</h2>
						<h2 class="hero-role">
							<span class="text-accent">NERD_</span>
							<span class="cursor">|</span>
						</h2>
					</div>
				</div>
			</div>
		</section>

		<!-- About Section -->
		<section class="about-section">
			<div class="brutal-card brutal-card-offset">
				<h2 class="section-title">
					<span class="text-accent">//</span> ABOUT_ME
				</h2>
				<div class="about-content">
					<p class="p-note">
						Aye up, I'm Matt (aka Dr_DinoMight), a developer of around 15 years.
						Full Stack Developer who loves to tinker with anything and everything.
						I love to build, be it personal projects or large scale community projects.
						As long as it's code it floats my boat!
					</p>
					<div class="mt-6">
						<SocialList />
					</div>
				</div>
			</div>
		</section>

		<!-- Motto Section -->
		<section class="motto-section">
			<blockquote class="motto-quote">
				<span class="quote-mark">"</span>
				<span class="brutal-link" data-text="Av' fun developing, Av' fun learning, then Av'a crack at engineering it!">
					Av' fun developing, Av' fun learning, then Av'a crack at engineering it!
				</span>
				<span class="quote-mark">"</span>
			</blockquote>
		</section>

		<!-- Recent Posts Section -->
		<section class="posts-section">
			<div class="section-header">
				<h2 class="section-title">
					<span class="text-accent">//</span> RECENT_POSTS
				</h2>
				<a href="/posts" class="brutal-btn">
					VIEW_ALL
				</a>
			</div>

			<div class="posts-grid">
				{allPostsByDate.map((p, index) => (
					<article class={`brutal-card post-card ${index % 3 === 1 ? 'brutal-card-offset' : ''}`}>
						{p.data.ogImage && (
							<div class="post-card-image">
								<img src={p.data.ogImage} alt={p.data.title} loading="lazy" />
								<div class="image-overlay" aria-hidden="true"></div>
							</div>
						)}
						<div class="post-card-content">
							<time datetime={p.data.publishDate.toISOString()} class="post-date">
								{new Date(p.data.publishDate).toLocaleDateString('en-GB', {
									year: 'numeric',
									month: 'short',
									day: 'numeric'
								}).toUpperCase().replace(/ /g, '_')}
							</time>
							<h3 class="post-title">
								<a href={`/posts/${p.slug}/`} class="brutal-link" data-text={p.data.title}>
									{p.data.title}
								</a>
							</h3>
							{p.data.description && (
								<p class="post-description">{p.data.description}</p>
							)}
							{p.data.tags && p.data.tags.length > 0 && (
								<div class="post-tags">
									{p.data.tags.slice(0, 3).map((tag) => (
										<a
											href={`/tags/${getTagSlug(tag)}`}
											class="brutal-tag"
											title={`View posts with tag: ${formatTagForDisplay(tag)}`}
										>
											{formatTagForDisplay(tag)}
										</a>
									))}
								</div>
							)}
						</div>
					</article>
				))}
			</div>
		</section>
	</div>

	<style>
		.home-page {
			display: flex;
			flex-direction: column;
			gap: 4rem;
		}

		/* Hero Section */
		.hero-section {
			padding: 2rem 0;
		}

		.hero-grid {
			display: grid;
			grid-template-columns: auto 1fr;
			gap: 3rem;
			align-items: center;
		}

		.hero-image-container {
			position: relative;
			width: 200px;
			height: 200px;
		}

		.hero-image {
			width: 100%;
			height: 100%;
			object-fit: cover;
			border: 4px solid var(--theme-accent);
			filter: grayscale(100%) contrast(1.1);
			transition: filter 0.3s ease;
		}

		.hero-image-container:hover .hero-image {
			filter: grayscale(0%) contrast(1);
		}

		.image-glitch-overlay {
			position: absolute;
			top: 4px;
			left: 4px;
			right: -4px;
			bottom: -4px;
			border: 2px solid var(--glitch-cyan);
			pointer-events: none;
			opacity: 0.5;
		}

		.hero-content {
			display: flex;
			flex-direction: column;
			gap: 0;
		}

		.hero-titles {
			display: flex;
			flex-direction: column;
			gap: 0;
		}

		.hero-role {
			font-family: 'Space Mono', monospace;
			font-size: clamp(1.5rem, 5vw, 3rem);
			font-weight: 700;
			line-height: 1.1;
			margin: 0;
			text-transform: uppercase;
			letter-spacing: 0.02em;
		}

		.text-glitch-cyan {
			color: var(--glitch-cyan);
		}

		.cursor {
			color: var(--theme-accent);
			animation: blink 1s infinite;
		}

		@keyframes blink {
			0%, 50% { opacity: 1; }
			51%, 100% { opacity: 0; }
		}

		/* About Section */
		.about-section {
			max-width: 800px;
		}

		.section-title {
			font-family: 'Space Mono', monospace;
			font-size: 1.5rem;
			font-weight: 700;
			margin-bottom: 1.5rem;
			text-transform: uppercase;
			letter-spacing: 0.05em;
			color: var(--theme-text);
		}

		.about-content {
			color: var(--theme-text);
		}

		.p-note {
			font-size: 1.1rem;
			line-height: 1.7;
			color: var(--theme-muted);
		}

		/* Motto Section */
		.motto-section {
			padding: 2rem 0;
			border-top: 2px solid var(--theme-accent);
			border-bottom: 2px solid var(--theme-accent);
		}

		.motto-quote {
			font-family: 'Space Mono', monospace;
			font-size: clamp(1rem, 3vw, 1.5rem);
			text-align: center;
			color: var(--theme-text);
			margin: 0;
			padding: 0;
			border: none;
		}

		.quote-mark {
			color: var(--theme-accent);
			font-size: 2em;
			line-height: 0;
			vertical-align: middle;
		}

		/* Posts Section */
		.section-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 2rem;
			flex-wrap: wrap;
			gap: 1rem;
		}

		.posts-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
			gap: 1.5rem;
		}

		.post-card {
			display: flex;
			flex-direction: column;
		}

		.post-card-image {
			position: relative;
			height: 180px;
			overflow: hidden;
			margin: -1.5rem -1.5rem 1rem -1.5rem;
			border-bottom: 4px solid var(--theme-accent);
		}

		.post-card-image img {
			width: 100%;
			height: 100%;
			object-fit: cover;
			filter: grayscale(100%);
			transition: filter 0.3s ease;
		}

		.post-card:hover .post-card-image img {
			filter: grayscale(0%);
		}

		.image-overlay {
			position: absolute;
			inset: 0;
			background: linear-gradient(
				180deg,
				transparent 0%,
				rgba(0, 0, 0, 0.8) 100%
			);
			mix-blend-mode: multiply;
		}

		.post-date {
			display: block;
			font-family: 'Space Mono', monospace;
			font-size: 0.75rem;
			color: var(--theme-accent);
			margin-bottom: 0.5rem;
			letter-spacing: 0.1em;
		}

		.post-title {
			font-family: 'Space Mono', monospace;
			font-size: 1.25rem;
			font-weight: 700;
			margin: 0 0 0.75rem 0;
			text-transform: uppercase;
			line-height: 1.3;
		}

		.post-title a {
			color: var(--theme-text);
			transition: color 0.15s ease;
		}

		.post-title a:hover {
			color: var(--theme-accent);
		}

		.post-description {
			font-size: 0.9rem;
			color: var(--theme-muted);
			line-height: 1.5;
			margin: 0 0 1rem 0;
		}

		.post-tags {
			display: flex;
			flex-wrap: wrap;
			gap: 0.5rem;
			margin-top: auto;
		}

		/* Responsive */
		@media (max-width: 768px) {
			.hero-grid {
				grid-template-columns: 1fr;
				text-align: center;
			}

			.hero-image-container {
				margin: 0 auto;
				width: 150px;
				height: 150px;
			}

			.hero-titles {
				align-items: center;
			}

			.posts-grid {
				grid-template-columns: 1fr;
			}

			.section-header {
				flex-direction: column;
				align-items: flex-start;
			}
		}
	</style>
</PageLayout>
