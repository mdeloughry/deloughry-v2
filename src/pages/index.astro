---
import { getCollection } from "astro:content";
import PageLayout from "@/layouts/Base";
import SocialList from "@/components/SocialList";
import MeImage from "../assets/image.webp";
import { sortMDByDate, getTagSlug, formatTagForDisplay } from "@/utils";
import { Image } from "astro:assets";

const MAX_POSTS = 10;
const allPosts = await getCollection("post");
const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS);
export const prerender = true;
---

<PageLayout meta={{ title: "Home" }}>
	<div class="home-page">
		<!-- Epic Hero Section -->
		<header class="home-hero">
			<div class="hero-content">
				<div class="hero-image-wrapper">
					<div class="image-glow" aria-hidden="true"></div>
					<Image
						src={MeImage}
						height={MeImage.height}
						width={MeImage.width}
						alt="Matthew Peck-Deloughry"
						class="profile-photo"
						transition:name={"profile-image"}
					/>
					<div class="image-scan-line" aria-hidden="true"></div>
				</div>
				<div class="hero-text">
					<a class="u-url hidden" rel="me" href="https://deloughry.co.uk/">Matthew Peck-Deloughry</a>
					<a class="u-url hidden" href="acct:matt@deloughry.co.uk"></a>
					<h1 class="hero-title">
						<span class="title-line neon-text-cyan">Developer.</span>
						<span class="title-line neon-text-purple">Streamer.</span>
						<span class="title-line">
							<span class="strikethrough text-neon-pink/50">Tweeter.</span>
							<span class="neon-text">Tooter.</span>
						</span>
						<span class="title-line">
							&amp; a little bit of everything
							<span class="chrome-text">Nerdy!</span>
							<span class="cursor" aria-hidden="true">_</span>
						</span>
					</h1>
				</div>
			</div>
		</header>

		<!-- About Section -->
		<section class="about-section" aria-labelledby="about-heading">
			<div class="about-card neon-card">
				<h2 id="about-heading" class="section-title">
					<span class="title-decorator" aria-hidden="true">//</span>
					Av' fun developing, Av' fun learning, then Av'a crack at engineering it!
				</h2>
				<div class="about-content">
					<p class="p-note">
						Aye up, I'm Matt (aka Dr_DinoMight), a developer of something around 15 years (I think!?
						They all blend into one and other now).<br /><br />
						I'm a developer for the brilliant HMA Digital here in South Yorkshire, UK.<br /><br />
						I'm a Full Stack Developer who loves to tinker with anything and everything, I love to build,
						be it personal 1 person projects or large scale community projects, as long as it's code it floats
						my boat!<br /><br />
					</p>
					<SocialList />
				</div>
			</div>
		</section>

		<!-- Recent Posts Section -->
		<section class="recent-posts" aria-labelledby="posts-heading">
			<h2 id="posts-heading" class="section-title">
				<span class="title-decorator" aria-hidden="true">//</span>
				Recent Posts
			</h2>
			<div class="posts-grid">
				{allPostsByDate.map((p, index) => (
					<article class="post-card neon-card" style={`animation-delay: ${index * 0.1}s`}>
						{p.data.ogImage && (
							<div class="post-card-image">
								<img src={p.data.ogImage} alt="" aria-hidden="true" />
								<div class="image-overlay" aria-hidden="true"></div>
							</div>
						)}
						<div class="post-card-content">
							<time datetime={p.data.publishDate.toISOString()} class="post-card-date">
								{new Date(p.data.publishDate).toLocaleDateString('en-GB', {
									year: 'numeric',
									month: 'short',
									day: 'numeric'
								})}
							</time>
							<h3 class="post-card-title">
								<a href={`/posts/${p.slug}/`}>{p.data.title}</a>
							</h3>
							{p.data.description && <p class="post-card-description">{p.data.description}</p>}
							{p.data.tags && p.data.tags.length > 0 && (
								<div class="post-card-tags">
									{p.data.tags.slice(0, 3).map((tag) => (
										<a href={`/tags/${getTagSlug(tag)}`} class="neon-tag" title={`View posts with tag: ${formatTagForDisplay(tag)}`}>
											{formatTagForDisplay(tag)}
										</a>
									))}
								</div>
							)}
						</div>
					</article>
				))}
			</div>
		</section>
	</div>

	<style>
		.home-page {
			max-width: 1200px;
			margin: 0 auto;
			padding: 1rem;
		}

		/* Hero Section */
		.home-hero {
			margin-bottom: 4rem;
			padding: 2rem 0;
		}

		.hero-content {
			display: flex;
			align-items: center;
			gap: 3rem;
		}

		.hero-image-wrapper {
			flex-shrink: 0;
			position: relative;
			width: 220px;
			height: 220px;
		}

		.image-glow {
			position: absolute;
			inset: -10px;
			background: linear-gradient(135deg, var(--neon-pink), var(--neon-cyan), var(--neon-purple));
			border-radius: 16px;
			opacity: 0.5;
			filter: blur(20px);
			animation: glow-pulse 3s ease-in-out infinite;
			pointer-events: none;
			user-select: none;
		}

		@keyframes glow-pulse {
			0%, 100% { opacity: 0.3; transform: scale(1); }
			50% { opacity: 0.6; transform: scale(1.05); }
		}

		.profile-photo {
			position: relative;
			z-index: 2;
			width: 100%;
			height: 100%;
			border-radius: 12px;
			border: 2px solid var(--neon-pink);
			box-shadow:
				0 0 10px var(--neon-pink),
				0 0 20px var(--neon-pink),
				inset 0 0 20px rgba(255, 107, 157, 0.1);
			transition: all 0.3s ease;
			object-fit: cover;
		}

		.profile-photo:hover {
			box-shadow:
				0 0 20px var(--neon-pink),
				0 0 40px var(--neon-pink),
				0 0 60px var(--neon-cyan),
				inset 0 0 30px rgba(255, 107, 157, 0.2);
			transform: scale(1.02);
		}

		.image-scan-line {
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 2px;
			background: linear-gradient(90deg, transparent, var(--neon-cyan), transparent);
			opacity: 0.8;
			z-index: 3;
			animation: scan 2s ease-in-out infinite;
			pointer-events: none;
			user-select: none;
		}

		@keyframes scan {
			0%, 100% { top: 0; opacity: 0; }
			10% { opacity: 0.8; }
			90% { opacity: 0.8; }
			100% { top: 100%; opacity: 0; }
		}

		.hero-text {
			flex: 1;
		}

		.hero-title {
			font-size: 2.2rem;
			font-weight: 700;
			line-height: 1.3;
			margin: 0;
			font-family: 'Orbitron', sans-serif;
			text-transform: uppercase;
			letter-spacing: 2px;
		}

		.title-line {
			display: block;
			margin-bottom: 0.5rem;
		}

		.neon-text-cyan {
			color: var(--neon-cyan);
			text-shadow:
				0 0 5px var(--neon-cyan),
				0 0 10px var(--neon-cyan),
				0 0 20px var(--neon-cyan);
		}

		.neon-text-purple {
			color: var(--neon-purple);
			text-shadow:
				0 0 5px var(--neon-purple),
				0 0 10px var(--neon-purple),
				0 0 20px var(--neon-purple);
		}

		.strikethrough {
			text-decoration: line-through;
			opacity: 0.5;
		}

		.cursor {
			color: var(--neon-chartreuse);
			animation: blink 1s step-end infinite;
		}

		@keyframes blink {
			0%, 100% { opacity: 1; }
			50% { opacity: 0; }
		}

		/* About Section */
		.about-section {
			margin-bottom: 4rem;
		}

		.about-card {
			padding: 2.5rem;
			border-radius: 12px;
		}

		.section-title {
			font-size: 1.5rem;
			font-weight: 600;
			margin-bottom: 2rem;
			color: var(--neon-pink);
			font-family: 'Orbitron', sans-serif;
			text-transform: uppercase;
			letter-spacing: 1px;
			text-shadow: 0 0 10px rgba(255, 107, 157, 0.5);
		}

		.title-decorator {
			color: var(--neon-cyan);
			margin-right: 0.5rem;
		}

		.about-content {
			display: grid;
			grid-template-columns: 1fr auto;
			gap: 2rem;
			align-items: start;
		}

		.p-note {
			font-size: 1rem;
			line-height: 1.8;
			color: var(--theme-text);
			margin: 0;
			opacity: 0.9;
		}

		/* Recent Posts */
		.recent-posts {
			margin-bottom: 2rem;
		}

		.posts-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
			gap: 1.5rem;
		}

		.post-card {
			border-radius: 12px;
			overflow: hidden;
			opacity: 0;
			animation: fade-in 0.5s ease-out forwards;
		}

		@keyframes fade-in {
			from {
				opacity: 0;
				transform: translateY(20px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.post-card-image {
			position: relative;
			overflow: hidden;
			height: 180px;
		}

		.post-card-image img {
			width: 100%;
			height: 100%;
			object-fit: cover;
			transition: all 0.3s ease;
			filter: saturate(0.8);
		}

		.post-card:hover .post-card-image img {
			filter: saturate(1.2);
			transform: scale(1.05);
		}

		.image-overlay {
			position: absolute;
			inset: 0;
			background: linear-gradient(
				180deg,
				transparent 0%,
				rgba(10, 10, 10, 0.3) 50%,
				rgba(10, 10, 10, 0.8) 100%
			);
			pointer-events: none;
			user-select: none;
		}

		.post-card-content {
			padding: 1.5rem;
		}

		.post-card-date {
			display: block;
			font-size: 0.8rem;
			color: var(--neon-cyan);
			font-weight: 500;
			margin-bottom: 0.5rem;
			font-family: 'Orbitron', sans-serif;
			text-transform: uppercase;
			letter-spacing: 1px;
		}

		.post-card-title {
			margin: 0 0 0.75rem 0;
			font-size: 1.3rem;
			font-weight: 600;
			font-family: 'Orbitron', sans-serif;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}

		.post-card-title a {
			color: var(--theme-text);
			text-decoration: none;
			transition: all 0.3s ease;
		}

		.post-card-title a:hover {
			color: var(--neon-pink);
			text-shadow: 0 0 10px var(--neon-pink);
		}

		/* Focus state for post links - uses cyan */
		.post-card-title a:focus-visible {
			outline: none;
			color: var(--neon-cyan);
			text-shadow: 0 0 10px var(--neon-cyan);
		}

		.post-card-description {
			margin: 0 0 1rem 0;
			color: var(--theme-quote);
			font-style: italic;
			line-height: 1.5;
			font-size: 0.9rem;
		}

		.post-card-tags {
			display: flex;
			flex-wrap: wrap;
			gap: 0.5rem;
		}

		/* Mobile Responsive */
		@media (max-width: 768px) {
			.home-page {
				padding: 0.5rem;
			}

			.hero-content {
				flex-direction: column;
				text-align: center;
			}

			.hero-image-wrapper {
				width: 180px;
				height: 180px;
			}

			.hero-title {
				font-size: 1.5rem;
			}

			.about-content {
				grid-template-columns: 1fr;
			}

			.posts-grid {
				grid-template-columns: 1fr;
			}
		}

		/* Reduced motion support */
		@media (prefers-reduced-motion: reduce) {
			.image-glow {
				animation: none;
				opacity: 0.4;
			}

			.image-scan-line {
				animation: none;
				display: none;
			}

			.cursor {
				animation: none;
				opacity: 1;
			}

			.profile-photo {
				transition: none;
			}

			.profile-photo:hover {
				transform: none;
			}

			.post-card {
				animation: none;
				opacity: 1;
			}

			.post-card-image img {
				transition: none;
			}

			.post-card:hover .post-card-image img {
				transform: none;
			}

			.post-card-title a {
				transition: none;
			}

			.post-card-title a:hover,
			.post-card-title a:focus-visible {
				text-shadow: none;
			}
		}
	</style>
</PageLayout>
