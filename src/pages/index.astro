---
import { getCollection } from "astro:content";
import PageLayout from "@/layouts/Base";
import SocialList from "@/components/SocialList";
import { sortMDByDate, getTagSlug, formatTagForDisplay } from "@/utils";

const MAX_POSTS = 10;
const allPosts = await getCollection("post");
const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS);
export const prerender = true;
---

<PageLayout meta={{ title: "Home" }}>
	<div class="bbs-home">
		<!-- ASCII Art Hero Banner -->
		<section class="hero-section" aria-labelledby="hero-title">
			<div class="bbs-box p-4 mb-4">
				<!-- ASCII Art Name - decorative only -->
				<div class="hidden sm:block" aria-hidden="true">
					<pre class="ascii-art text-center mx-auto">
╔═══════════════════════════════════════════════════════════════════════════╗
║  ███╗   ███╗ █████╗ ████████╗████████╗                                    ║
║  ████╗ ████║██╔══██╗╚══██╔══╝╚══██╔══╝                                    ║
║  ██╔████╔██║███████║   ██║      ██║                                       ║
║  ██║╚██╔╝██║██╔══██║   ██║      ██║                                       ║
║  ██║ ╚═╝ ██║██║  ██║   ██║      ██║   <span class="text-bbs-cyan">PECK-DELOUGHRY</span>                     ║
║  ╚═╝     ╚═╝╚═╝  ╚═╝   ╚═╝      ╚═╝   <span class="text-bbs-magenta">Developer // Streamer</span>             ║
╠═══════════════════════════════════════════════════════════════════════════╣
║ <span class="text-bbs-cyan">[WELCOME TO MY PERSONAL BBS - ESTABLISHED 2024]</span>                          ║
╚═══════════════════════════════════════════════════════════════════════════╝
					</pre>
				</div>

				<!-- Screen reader accessible title -->
				<h1 id="hero-title" class="sr-only sm:sr-only">
					Matt Peck-Deloughry - Developer and Streamer. Welcome to my personal BBS, established 2024.
				</h1>

				<!-- Mobile version - visible alternative -->
				<div class="sm:hidden text-center">
					<h1 class="text-2xl text-accent font-bold mb-2">MATT</h1>
					<p class="text-bbs-cyan text-sm">PECK-DELOUGHRY</p>
					<p class="text-bbs-magenta text-xs">Developer // Streamer</p>
					<p class="text-xs text-bbs-gray mt-2">[WELCOME TO MY PERSONAL BBS]</p>
				</div>
			</div>
		</section>

		<!-- Quick Info / Status -->
		<section class="status-section mb-4" aria-labelledby="status-heading">
			<div class="bbs-box">
				<div class="px-3 py-1 border-b border-bbs-gray flex items-center gap-2">
					<span class="text-accent" aria-hidden="true">┌─[</span>
					<h2 id="status-heading" class="text-bbs-cyan font-bold">SYSOP STATUS</h2>
					<span class="text-accent" aria-hidden="true">]─</span>
				</div>
				<div class="p-3 grid grid-cols-1 sm:grid-cols-3 gap-2 text-sm">
					<div>
						<span class="text-bbs-gray">Location:</span>
						<span class="text-bbs-cyan">Sheffield, UK</span>
					</div>
					<div>
						<span class="text-bbs-gray">Status:</span>
						<span class="text-accent">ONLINE</span>
						<span class="blink-slow" aria-hidden="true">_</span>
					</div>
					<div>
						<span class="text-bbs-gray">Mood:</span>
						<span class="text-bbs-magenta">Coding</span>
					</div>
				</div>
			</div>
		</section>

		<!-- About Section -->
		<section class="about-section mb-4" aria-labelledby="about-heading">
			<div class="bbs-box">
				<div class="px-3 py-1 border-b border-bbs-gray flex items-center gap-2">
					<span class="text-accent" aria-hidden="true">┌─[</span>
					<h2 id="about-heading" class="text-bbs-cyan font-bold">ABOUT THE SYSOP</h2>
					<span class="text-accent" aria-hidden="true">]─</span>
				</div>
				<div class="p-3">
					<div class="flex flex-col sm:flex-row gap-4">
						<div class="flex-1">
							<p class="text-sm leading-relaxed mb-3">
								<span class="text-bbs-cyan" aria-hidden="true">&gt;</span> Aye up, I'm Matt (aka <span class="text-accent">Dr_DinoMight</span>), a developer of something around 15 years (I think!? They all blend into one and other now).
							</p>
							<p class="text-sm leading-relaxed mb-3">
								<span class="text-bbs-cyan" aria-hidden="true">&gt;</span> I'm a developer for the brilliant <span class="text-bbs-magenta">HMA Digital</span> here in South Yorkshire, UK.
							</p>
							<p class="text-sm leading-relaxed mb-3">
								<span class="text-bbs-cyan" aria-hidden="true">&gt;</span> I'm a Full Stack Developer who loves to tinker with anything and everything. I love to build, be it personal 1 person projects or large scale community projects, as long as it's code it floats my boat!
							</p>
							<blockquote class="border-l-2 border-accent pl-3 mt-4 text-bbs-gray italic">
								"Av' fun developing, Av' fun learning, then Av'a crack at engineering it!"
							</blockquote>
						</div>
					</div>
					<div class="mt-4 pt-3 border-t border-bbs-gray">
						<SocialList />
					</div>
				</div>
			</div>
		</section>

		<!-- Role/Skills Banner -->
		<section class="skills-banner mb-4" aria-label="Skills and roles">
			<div class="flex flex-wrap gap-2 justify-center text-xs">
				<span class="ansi-cyan px-2 py-1 font-bold">DEVELOPER</span>
				<span class="ansi-magenta px-2 py-1 font-bold">STREAMER</span>
				<span class="ansi-blue px-2 py-1 font-bold">TOOTER</span>
				<span class="ansi-yellow px-2 py-1 font-bold">NERD</span>
			</div>
		</section>

		<!-- Recent Posts Section -->
		<section class="posts-section" aria-labelledby="posts-heading">
			<div class="bbs-box">
				<div class="px-3 py-1 border-b border-bbs-gray flex items-center justify-between">
					<div class="flex items-center gap-2">
						<span class="text-accent" aria-hidden="true">┌─[</span>
						<h2 id="posts-heading" class="text-bbs-cyan font-bold">MESSAGE BOARD</h2>
						<span class="text-accent" aria-hidden="true">]─</span>
					</div>
					<span class="text-bbs-gray text-xs">{allPostsByDate.length} posts</span>
				</div>

				<div class="divide-y divide-bbs-gray">
					{allPostsByDate.map((p, index) => (
						<article class="p-3 hover:bg-bbs-dark-gray transition-colors">
							<div class="flex flex-col sm:flex-row sm:items-start gap-2">
								<div class="flex items-center gap-2 text-xs">
									<span class="text-bbs-magenta" aria-hidden="true">[{String(index + 1).padStart(2, '0')}]</span>
									<time datetime={p.data.publishDate.toISOString()} class="text-bbs-gray">
										{new Date(p.data.publishDate).toLocaleDateString('en-GB', {
											year: '2-digit',
											month: '2-digit',
											day: '2-digit'
										})}
									</time>
								</div>
								<div class="flex-1">
									<h3 class="text-sm">
										<a href={`/posts/${p.slug}/`} class="bbs-link text-bbs-cyan hover:text-accent transition-colors">
											{p.data.title}
										</a>
									</h3>
									{p.data.description && (
										<p class="text-xs text-bbs-gray mt-1 line-clamp-2">{p.data.description}</p>
									)}
									{p.data.tags && p.data.tags.length > 0 && (
										<div class="flex flex-wrap gap-1 mt-2">
											{p.data.tags.slice(0, 3).map((tag) => (
												<a
													href={`/tags/${getTagSlug(tag)}`}
													class="bbs-tag text-xs"
													title={`View posts with tag: ${formatTagForDisplay(tag)}`}
												>
													{formatTagForDisplay(tag)}
												</a>
											))}
										</div>
									)}
								</div>
							</div>
						</article>
					))}
				</div>

				<div class="px-3 py-2 border-t border-bbs-gray text-center">
					<a href="/posts" class="bbs-button text-xs">
						<span aria-hidden="true">[V]</span> VIEW ALL POSTS
					</a>
				</div>
			</div>
		</section>

		<!-- Quick Links Section -->
		<section class="quick-links mt-4" aria-labelledby="quicklinks-heading">
			<div class="bbs-box">
				<div class="px-3 py-1 border-b border-bbs-gray flex items-center gap-2">
					<span class="text-accent" aria-hidden="true">┌─[</span>
					<h2 id="quicklinks-heading" class="text-bbs-cyan font-bold">QUICK JUMP</h2>
					<span class="text-accent" aria-hidden="true">]─</span>
				</div>
				<nav class="p-3 grid grid-cols-2 sm:grid-cols-4 gap-2 text-sm" aria-label="Quick navigation">
					<a href="/about" class="bbs-menu-item p-2 text-center text-bbs-cyan" aria-label="About">
						<span class="text-bbs-magenta" aria-hidden="true">[A]</span>bout
					</a>
					<a href="/projects" class="bbs-menu-item p-2 text-center text-bbs-cyan" aria-label="Projects">
						<span class="text-bbs-magenta" aria-hidden="true">[P]</span>rojects
					</a>
					<a href="/recipes" class="bbs-menu-item p-2 text-center text-bbs-cyan" aria-label="Recipes">
						<span class="text-bbs-magenta" aria-hidden="true">[R]</span>ecipes
					</a>
					<a href="/bookmarks" class="bbs-menu-item p-2 text-center text-bbs-cyan" aria-label="Bookmarks">
						<span class="text-bbs-magenta" aria-hidden="true">[B]</span>ookmarks
					</a>
				</nav>
			</div>
		</section>
	</div>
</PageLayout>

<style>
	.bbs-home {
		font-family: 'IBM Plex Mono', monospace;
	}

	.ascii-art {
		font-size: 0.55rem;
		line-height: 1.1;
		overflow-x: auto;
	}

	@media (min-width: 768px) {
		.ascii-art {
			font-size: 0.65rem;
		}
	}

	@media (min-width: 1024px) {
		.ascii-art {
			font-size: 0.75rem;
		}
	}

	/* Line clamp for descriptions */
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
</style>
