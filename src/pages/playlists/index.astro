---
import PageLayout from "@/layouts/Base";
import ImageWithBadge from "src/components/ImageWithBadge";
import type { Playlist } from "@/lib/types/spotify";


const playlists: Playlist[] = await (await fetch(import.meta.env.API_URL +'/spotify/playlists/monthly')).json();
const pastPlaylists: Playlist[] = await (await fetch(import.meta.env.API_URL +'/spotify/playlists/years')).json();
const meta = {
  title: "Spotify Jams",
  description: "A collection of monthly liked songs",
};

export const prerender = true
---

<PageLayout meta={meta}>
  <div class="bbs-playlists">
    <!-- Header -->
    <section class="header-section mb-4" aria-labelledby="playlists-heading">
      <div class="bbs-box">
        <div class="px-3 py-1 border-b border-bbs-gray flex items-center justify-between">
          <div class="flex items-center gap-2">
            <span class="text-accent" aria-hidden="true">┌─[</span>
            <h1 id="playlists-heading" class="text-bbs-cyan font-bold">JUKEBOX</h1>
            <span class="text-accent" aria-hidden="true">]─</span>
          </div>
          <span class="text-bbs-gray text-xs">
            {playlists.length + pastPlaylists.length} playlists
          </span>
        </div>

        <div class="p-3">
          <p class="text-sm text-bbs-gray">
            <span class="text-bbs-cyan" aria-hidden="true">&gt;</span> A collection of monthly liked songs and musical discoveries
          </p>
        </div>
      </div>
    </section>

    <!-- Current Year Playlists -->
    <section class="playlists-section mb-4" aria-labelledby="current-heading">
      <div class="bbs-box">
        <div class="px-3 py-1 border-b border-bbs-gray flex items-center gap-2">
          <span class="text-accent" aria-hidden="true">┌─[</span>
          <h2 id="current-heading" class="text-bbs-cyan font-bold">YEAR SO FAR</h2>
          <span class="text-accent" aria-hidden="true">]─</span>
        </div>

        <div class="p-3 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
          {playlists.map((playlist, index) => (
            <article class="playlist-item">
              <a href={`/playlists/${playlist.id}`} class="block bbs-box p-2 hover:bg-bbs-dark-gray transition-colors group">
                <div class="relative mb-2 overflow-hidden border border-bbs-gray">
                  <img
                    src={playlist.artwork[0]?.url ?? ""}
                    alt={`${playlist.name} playlist artwork`}
                    class="w-full aspect-square object-cover filter grayscale group-hover:grayscale-0 transition-all"
                  />
                  <div class="absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                    <span class="text-accent text-2xl" aria-hidden="true">▶</span>
                  </div>
                </div>
                <div>
                  <span class="text-bbs-magenta text-xs" aria-hidden="true">[{String(index + 1).padStart(2, '0')}]</span>
                  <h3 class="text-bbs-cyan text-xs font-bold truncate">{playlist.name}</h3>
                  <p class="text-bbs-gray text-xs">{playlist.tracks.length} tracks</p>
                </div>
              </a>
            </article>
          ))}
        </div>
      </div>
    </section>

    <!-- Past Years -->
    <section class="playlists-section" aria-labelledby="past-heading">
      <div class="bbs-box">
        <div class="px-3 py-1 border-b border-bbs-gray flex items-center gap-2">
          <span class="text-accent" aria-hidden="true">┌─[</span>
          <h2 id="past-heading" class="text-bbs-cyan font-bold">PAST JAMS</h2>
          <span class="text-accent" aria-hidden="true">]─</span>
        </div>

        <div class="p-3 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
          {pastPlaylists.map((playlist, index) => (
            <article class="playlist-item">
              <a href={`/playlists/${playlist.id}`} class="block bbs-box p-2 hover:bg-bbs-dark-gray transition-colors group">
                <div class="relative mb-2 overflow-hidden border border-bbs-gray">
                  <img
                    src={playlist.artwork[0]?.url ?? ""}
                    alt={`${playlist.name} playlist artwork`}
                    class="w-full aspect-square object-cover filter grayscale group-hover:grayscale-0 transition-all"
                  />
                  <div class="absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                    <span class="text-accent text-2xl" aria-hidden="true">▶</span>
                  </div>
                </div>
                <div>
                  <span class="text-bbs-magenta text-xs" aria-hidden="true">[{String(index + 1).padStart(2, '0')}]</span>
                  <h3 class="text-bbs-cyan text-xs font-bold truncate">{playlist.name}</h3>
                  <p class="text-bbs-gray text-xs">{playlist.tracks.length} tracks</p>
                </div>
              </a>
            </article>
          ))}
        </div>
      </div>
    </section>

    <!-- Actions -->
    <section class="actions-section mt-4" aria-label="Actions">
      <div class="bbs-box">
        <nav class="p-3 flex flex-wrap gap-2 justify-center" aria-label="Playlist navigation">
          <a href="/" class="bbs-button text-xs">
            <span aria-hidden="true">[M]</span> BACK TO MAIN
          </a>
        </nav>
      </div>
    </section>
  </div>
</PageLayout>

<style>
  .bbs-playlists {
    font-family: 'IBM Plex Mono', monospace;
  }

  .truncate {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
</style>
